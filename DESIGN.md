# Proseline Design

This document outlines the designs of Proseline's data model, protocol, and service architecture.

## Projects

The basic unit of organization in Proseline is the **project**.

The main work in a project takes the form of **drafts**.  Each draft contains the complete content of one version of a document, along with information on who created the draft, when, and which other drafts their work was based on, if any.

Clients can add **marks** to drafts to give them names, such as "latest and greatest".  Clients can move marks from draft to draft over time.

Clients can add **notes** to parts of drafts.  Notes are often used to share comments.

Clients can add **replies** to notes and the replies of others.

Clients can publish **corrections** to the texts of notes and replies.

## Clients

Each project has one or more **clients**, of three types:

1.  **Distributors** can share work in the project with others, but can't read the work or contribute to it.

2.  **Readers** can also read the work in the project, as well as distribute it.

3.  **Writers** can contribute work to the project, in addition to reading and distributing it. 

|             | Distribute | Read | Write |
|-------------|------------|------|-------|
| Distributor | Yes        |      |       |
| Reader      | Yes        | Yes  |       |
| Writer      | Yes        | Yes  | Yes   |

The proseline.com JavaScript application is a client that can distribute, read, and write.

The proseline.com server application is a client that distributes customers' projects.

A person may use one or more **devices**, each of which may run one or more clients.  When a person joins a project with at least one client, that person is a **member** of the project.

A person may or may not pay for a proseline.com **account**.

## Distributing

Clients contribute work to a project by creating and sharing project-specific **logs**.  Each log consists of **entries** for contributions to the project made with that particular client.

One member of a project may contribute to the project with multiple clients.  For example, they might use the proseline.com web app on their laptop, smartphone, and desktop.

## Accounts

The proseline.com server application provides services to paying customers:

1.  The server distributes all of their projects, so all members of the customer's projects can download work, even when other members aren't online.

2.  The server invites all of the customer's clients to all of the customer's projects, so they can work on projects across devices without inviting themself manually.

3.  The server stores invitations to all the customer's projects, so they can access them even if they lose all their clients.

The server stores keys for reading and writing to projects in encrypted form.  The server does _not_ store the customer's key for decrypting those keys.

People connect their clients to their paid accounts by logging in via links e-mailed to them by the server.

## Cryptography

On starting for the first time, a client generates a **client signing key** for signing requests to the proseline.com server application.

On creating a new project, a client generates:

- a random **project distribution key** for stream encryption of data distribution

- a **project discovery key**, the digest of the distribution key, for finding other clients of the project without disclosing the distribution key

- a random **project read key** for encrypting log entries

- a random **project write key pair** for signing entries to all project logs

On joining a project, a client generates a random **log key pair** for signing entries to the client's project log

## Inviting

To invite someone to a project, users share URLs generated by their clients:

- URLs for **distributors** include just the distribution key.

- URLs for readers also include the project read key and public project write key.

- URLs for writers also include the public secret project write key.
